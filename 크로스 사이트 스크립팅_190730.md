##  **크로스 사이트 스크립팅(Cross-Site Scripting, XSS)**

##### 공격자가 전달한 스크립트 코드가 사용자 브라우저를 통해서 실행되는 것

→ 사용자 브라우져 또는 사용자 PC의 저장된 정보를 탈취

→ 가짜 페이지를 만들어서 사용자로 하여금 추가 입력을 유도하고, 해당 정보를 탈취

→ 좀비화하여 원격에서 해당 PC를 조정 ⇒ BeEF

 John <script> alert(document.cookie)</script>

####  Reflective XSS (반사)

- 공격자가 전달한 스크립트 코드가 취약한 웹 서버를 경유해서 사용자 브라우저에 전달되는 방식 
- 입력값이 입력값 검증 또는 출력값 검증 없이 다음 화면 출력에 그대로 사용되는 경우에 발생

안녕! <%=request.getParameter("input")%>

<% 	

​	out.print("안녕! " + request.getParameter("input"));

%>

정상입력 : .../do.jsp?input=홍길동 => 안녕! 홍길동

비정상입출력 : .../do.jsp?input=<script>alert(document.cookie)</script>

 => 안녕! <script> alert(document.cookie)</script> => 해당 브라우저의 쿠키 값이 출력

### Stored XSS

공격자가 작성한 스크립트 코드가 취약한 서버에 저장되어 지속적으로 사용자 브라우저로 내려가서 실행되는 것 => 게시판

(공격자) 게시판 글쓰기 			--------------------> 					저장(서버)

 <script>...</script>                          <script>...</script>
(희생자) 게시판 글보기 -------------------------------------------------------

		<script>...</script>

### DOM XSS

개발자가 작성한 스크립트 코드의 취약점을 이용한 공격 기법

document.write(_____________)



**

WEB

교차자원공유(Cross Resource Sharing)

SOP(Same Origin Policy,동일 기원 정책

완화 =>  CORS(Cross Origin Resource Sharing)

ORIGIN : 스킴+호스트(도메인IP)+포트





## 크로스 사이트 요청 위조(CSRF)

서버로 전달된 요청을 요청 절차와 주체를 검증하지 않고 처리했을 때 발생

공격자가 심어 놓은 코드를 통한 자동화된 요청이 희생자의 권한으로 실행



* 패스워드 변경 신청 폼				-------->			패스워드 변경 처리

  chagePwForm.jsp													changePwProc.jsp

  ​																			#1 인증(로그인) 여부를 판단

  New PW :   														#2 변경에 필요한 정보(newPW) 가 포함되었는지 확인

  New PW:															#3 세션에서 사용자 정보를 추출(userId)

  ​							[ 변경]									#4 update userId.Pw <- newPw



로그인한 사람만 볼수 있음 : <iframe src="changePwProc.jsp?newPW=123" width="0" height="0">





#### 방어대책

* 요청 절차를 확인한다
  * Referer 요청 헤더를 검증
  * Token 을 검증
  * CAPTCHA, reCAPTCHA를 검증 = 자동화된 요청을 방지 = 사용자와의 상호작용을 통한 요청 처리
* 요청 주체를 확인한다.
  * 주요 기능에 대해서 재인증, 재인가 후 처리한다.
    * 정보가 생성, 수정, 삭제되는 경우 = 트랜젝션이 발생
    * 중요 정보를 다루는 기능
    * 과금이 발생하는 기능



- 글쓰기(GET, wirte.do)

  - 임의 값(토큰)생성

  - 세션에 저장(stoken)  -> 글쓰기 화면(write.jsp)

  - 위에 생성한 토큰을 히든 필드(ptoken)의 값으로 설정   ----> POST글저장(write.do)

  - 요청 파라미터 토큰과 세션에 저장된 토큰비교

    -> 일치 -> 글저장

    ->불일치 -> list.do 리다이렉트



###  파일 업로드 취약점

* 업로드 파일의 크기와 종류를 제한하지 않는 경우
  * 서버의 디스크 자원 또는 연결 자원을 고갈 => 서비스 거부 공격
  * (1)서버에서 실행될 수 있는 파일(SSS, 웹쉘)을 업로드해서 실행하여 서버의 제어권을 탈취
  * 클라이언트에서 실행될 수 있는 악성 코드가 포함된 파일을 업로드 => 악성코드의 유포지로 악용

* 업로드한 파일을 외부에서 접근 가능한 경로에 저장하는 경우 => WebRoot 아래 경로에 파일이 저장되는 경우

##### 방어기법

* 업로드 파일의 크기를 제한한다.
* 업로드 파일의 종류를 제한한다.
  * 확장자를 비교
  * Content-Type비교
  * File Signature
* **업로드 파일을 외부에서 접근할 수 없는 경로에 저장한다**. =WebRoot밖에 저장한다.
* 업로드 파일의 저장 경로와 파일명을 외부에서 알 수 없도록 변경해서 사용한다. => 파일명을 랜덤값, 날짜시간, 일련번호 등으로 수정.
* 업로드 파일의 실행 속성을 제거하고 저장한다.



### 파일 다운로드 취약점

* 경로조작을 여부를 검증하지 않거나
* 다운로드 파일의 내용을 검사하지 않고 다운로드 기능을 제공하는 경우에 발생
  * 권한 밖의 디렉터리 또는 파일에 접근이 가능
  * 악성 코드가 포함된 파일이 다운로드 될 수 있다.

#### 방어기법

* 경로조작 문자열 포함 여부를 확인
* 다운로드 전 파일의 무결성 검사 또는 내용 검증